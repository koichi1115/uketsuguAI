# 要件定義書

## 1. プロジェクト概要

### 1.1 背景・目的
大切な人を亡くした際、遺族は悲しみの中で数多くの煩雑な手続きを行わなければならない。手続きの種類は多岐にわたり、期限や優先順位の把握が難しく、精神的・時間的な負担が大きい。

本プロジェクトは、このような負担を軽減するため、AI技術を活用して以下を実現する：
- 個々の状況に応じた手続きタスクの自動洗い出し
- タスクの優先順位・期限の明確化
- 自治体の補助金・給付金情報の提示
- 進捗管理とリマインド

### 1.2 スコープ
**対象範囲:**
- 家族の死亡後に必要な各種手続きのタスク管理
- 法令、自治体情報、金融機関、保険等の情報に基づく個別最適化されたタスク提示
- LINE公式アカウントを通じたユーザーインターフェース

**対象外:**
- 法律相談・専門的なアドバイス（専門家への橋渡しは可）
- 手続きの代行

### 1.3 想定ユーザー
- 家族を亡くした方（遺族）
- 死亡後の手続きに不安を感じている方
- 手続きの全体像を把握したい方

### 1.4 提供価値
- 手続きの見落とし防止
- 優先順位の明確化による精神的負担の軽減
- 補助金・給付金情報の提供による経済的サポート
- 24時間いつでも相談できる安心感

---

## 2. 機能要件

### 2.1 LINE公式アカウント連携
#### 2.1.1 友達追加・初回ヒアリング
- LINE公式アカウント「受け継ぐAI」を新規作成
- 友達追加をトリガーに初回ヒアリングを開始
- ヒアリング項目：
  - 受け継ぐ家族との続柄（両親、父、母、叔父など）
  - 家族の状況（存命、死後など）
  - 家族の居住地（市町村単位）
  - 自分の居住地（市町村単位）※手続きに関係ない場合は省略可
  - 死亡日

#### 2.1.2 メッセージング機能
- LINE Messaging APIを活用
- ユーザーとのチャット形式でのやり取り
- タスク提示、進捗確認、リマインド送信

### 2.2 タスク洗い出し機能
#### 2.2.1 個別最適化されたタスク生成
- ヒアリング情報を元に、ユーザー固有のタスクを自動生成
- タスクの優先順位、期限を明示
- タスクの実行順序を提示

#### 2.2.2 補助金・給付金情報の提示
- 居住自治体の補助金情報を検索
- 申請により給付されるお金の情報を提示
- 申請方法・期限を明示

#### 2.2.3 知識ベースの構築（RAG方式）
- **RAG（Retrieval-Augmented Generation）構成**
  - Cloud Storage（S3/GCS）でドキュメント管理
  - Embedding処理: OpenAI API / Gemini API
  - ベクトルDB: Pinecone（無料枠）/ ChromaDB（オープンソース）
- 蓄積する情報：
  - e-gov の関係法令
  - 自治体の情報（Webサイト、PDF等）
  - 保険、金融機関の手続き情報
  - X（旧Twitter）やWeb上のtips、豆知識
  - お得な情報、必須手続き情報

#### 2.2.4 情報収集の自動化
- **chrome-dev-mcpツールを活用した自動スクレイピング**
  - APIが提供されていない自治体サイトからの情報収集
  - 金融機関、保険会社のWebサイトからの情報収集
- **定期的な情報更新**
  - スケジューラによる定期実行（週次/月次）
  - 変更検知と差分更新
- **収集データの前処理**
  - HTMLからテキスト抽出
  - PDF解析（OCR含む）
  - 構造化データへの変換

### 2.3 AI連携機能
#### 2.3.1 会話AI（Gemini or Claude API）
- ユーザーとの自然な対話
- 質問への回答
- タスクの詳細説明
- 情報提供

#### 2.3.2 タスク連携
- ユーザーの状況に応じた動的なタスク調整
- 新たに必要となったタスクの追加提案

### 2.4 タスク管理機能
#### 2.4.1 タスク一覧表示
- ユーザー別のタスク一覧をDatabaseに登録
- LINE上でタスク一覧を表示
- Googleフォームライクなチェックリスト形式での表示も可能

#### 2.4.2 タスク完了報告
- LINEメッセージでの報告（例: 「タスク1終わったよ」）
- チェックリストへのチェックによる報告
- 完了後、次のタスクを自動提示

#### 2.4.3 進捗管理
- タスク完了状況の記録
- 未完了タスクのリマインド
- 期限が近いタスクの通知

### 2.5 恩送り（Pay It Forward）機能
#### 2.5.1 恩送りメッセージ機能
- **コメント入力**: 恩送り支払い時に次のユーザーへのメッセージを任意で入力可能
  - 最大文字数: 200文字
  - 内容例: 励ましの言葉、応援メッセージ、体験談など
  - 不適切な内容の自動フィルタリング（誹謗中傷、個人情報等）

- **コメント表示**: 新規ユーザーの初回利用時に前のユーザーからのメッセージを表示
  - ランダムに1件を選択して表示
  - 匿名表示（「前のユーザーさん」）
  - 送信者の個人情報は一切表示しない

#### 2.5.2 恩送り統計の可視化
- **恩送りカウンター**:
  - 累計恩送り人数: 「これまでに○○人が恩を送ってくれました」
  - 現在の恩送りプール: 「現在、○○人分の善意が集まっています」
  - 新規ユーザー数との比較: 恩送り人数 > 新規ユーザー数の判定

- **表示タイミング**:
  - 初回利用時（恩送りにより無料であることを明示）
  - 優先度高タスク完了時（恩送り依頼前）
  - 全タスク完了時（最終的な感謝メッセージ）

- **統計情報の更新**:
  - リアルタイム更新（恩送りがあるたびに即座に反映）
  - データベースで管理（pay_it_forward_stats テーブル）

#### 2.5.3 条件分岐メッセージ
- **恩送り人数 > 新規ユーザー数の場合**:
  - 「○○人の方々の善意によって無料で使える」ことを明示
  - 前のユーザーからのメッセージを1件表示
  - 感謝の気持ちを強調

- **恩送り人数 ≦ 新規ユーザー数の場合**:
  - シンプルに「完全無料で使える」ことを伝える
  - プレッシャーを与えない表現

#### 2.5.4 データ管理
- **恩送り記録**:
  - 支払い日時
  - 支払い金額
  - コメント内容（任意）
  - ユーザーID（匿名化）

- **表示ロジック**:
  - コメントのプール管理（未表示のコメントを優先）
  - 不適切なコメントの除外
  - ランダム表示による公平性の確保

---

## 3. 非機能要件

### 3.1 セキュリティ
- 個人情報の適切な管理（暗号化、アクセス制御）
- LINE公式アカウントのセキュリティ設定
- API通信の暗号化（HTTPS）
- データベースへのアクセス制限

### 3.2 パフォーマンス
- メッセージ応答時間: 3秒以内
- タスク生成時間: 10秒以内
- 同時接続ユーザー数: 初期は10人程度を想定（スモールスタート）

### 3.3 可用性
- 稼働率: 99%以上
- メンテナンス時間は事前通知

### 3.4 使いやすさ
- LINEという馴染みのあるUIを活用
- 専門用語を避けた分かりやすい表現
- シンプルな操作フロー

### 3.5 拡張性
- 将来的な横展開（保活等）を見据えた設計
- タスク種別の追加が容易な構造

---

## 4. 技術要件

### 4.1 使用技術（候補）
#### フロントエンド
- LINE Messaging API
- LINE公式アカウント

#### バックエンド
- Python / Node.js（選定中）
- AI API: Gemini API / Claude API / OpenAI API
- RAG構成:
  - Cloud Storage: AWS S3 / Google Cloud Storage
  - Embedding: OpenAI Embedding API / Gemini Embedding
  - ベクトルDB: Pinecone（無料枠） / ChromaDB
- 情報収集: chrome-dev-mcp（Webスクレイピング）
- データパイプライン: スケジューラ（cron / Cloud Scheduler）

#### データベース
- PostgreSQL / MySQL（選定中）
- ユーザー情報、タスク情報の管理

#### インフラ
- クラウド: AWS / GCP（選定中）
- サーバーレス構成（AWS Lambda / Cloud Functions）を検討

### 4.2 外部連携
- LINE Messaging API
- Gemini API / Claude API / OpenAI API
- OpenAI Embedding API / Gemini Embedding API
- Pinecone API（ベクトルDB）
- chrome-dev-mcp（Webスクレイピング）
- e-gov API（法令データ取得）
- 自治体オープンデータAPI（可能な範囲で）

### 4.3 開発環境
- バージョン管理: Git / GitHub
- 開発言語: Python / JavaScript（選定中）
- 文字コード: UTF-8
- 改行コード: LF

---

## 5. ビジネスモデル

### 5.1 収益モデル：Pay It Forward（恩送り）モデル

#### 5.1.1 基本方針
**「誰かの善意が、次の誰かを救う」** 循環型の相互扶助モデル

- **完全無料スタート**: すべてのユーザーが0円でサービス利用開始
- **任意の支払い**: 助かった人が「次の人のため」に任意で支払う
- **強制なし**: 支払わなくてもサービス利用に制限なし

#### 5.1.2 収益化の仕組み

**フェーズ1: 利用開始〜優先度高タスク進行中**
```
【初回利用時のメッセージ】

■ 恩送り人数 > 新規ユーザー数の場合：
「こんにちは。UketsuguAIへようこそ。

 あなたは、○○人の方々の善意によって
 このサービスを無料で使うことができます。

 『前のユーザーさんからのメッセージ』
 "大変な時期ですが、一緒に乗り越えましょう。
  私もこのサービスに助けられました。"

 あなたも困っている時、
 誰かに支えられています。

 一緒に乗り越えていきましょう。」

■ 恩送り人数 ≦ 新規ユーザー数の場合：
「こんにちは。UketsuguAIへようこそ。

 このサービスは完全無料でご利用いただけます。

 一緒に、必要な手続きを整理していきましょう。」

---

✓ 完全無料でサービス利用
✓ 一切の支払い義務なし
✓ すべての機能が使える
```

**フェーズ2: 優先度高タスク完了時（任意の恩送り）**
```
【メッセージ例】
「おめでとうございます！
 優先度の高いタスクが完了しました。

 あなたは誰かの善意で
 このサービスを無料で使えました。

 次に困っている誰かのために、
 あなたも恩を送りませんか？」

[500円で次の1人を助ける]
[1,000円で次の2人を助ける]
[3,000円で次の6人を助ける]
[今はパス（次回でも可）]

【支払いを選択した場合】
「ありがとうございます！
 よろしければ、次に使う方へ
 メッセージを残しませんか？（任意）」

[コメント入力欄]
例：「大変な時期ですが、一緒に乗り越えましょう」
例：「このサービスに助けられました。応援しています」

[送信する] [スキップ]
```

**フェーズ3: 全タスク完了時（任意の感謝の気持ち）**
```
【メッセージ例】
「すべてのタスクが完了しました！
 本当にお疲れ様でした。

 UketsuguAIはあなたのお役に立てましたか？

 もしよろしければ、
 あなたが感じた価値の分だけ
 ご支援いただけないでしょうか。

 次に困っている誰かを助けることができます。」

[とても助かった: 3,000円]
[助かった: 1,500円]
[まあまあ: 500円]
[支払わない: 0円] ← これもOK
[自分で金額を決める: ___円]
```

#### 5.1.3 決済方法
- **決済システム**: Stripe
- **支払い方法**: クレジットカード、LINE Pay連携（検討）
- **手数料**: 決済手数料はサービス側で負担

#### 5.1.4 収益予測（1,000人/月利用時）

**控えめシナリオ**:
```
優先度高タスク完了時（恩送り）
  支払い率: 30%（平均1,000円）
  → 300人 × 1,000円 = 30万円/月

全タスク完了時（感謝の気持ち）
  支払い率: 20%（平均1,500円）
  → 200人 × 1,500円 = 30万円/月

月額収益: 約60万円
年間収益: 約720万円
```

**楽観的シナリオ**:
```
優先度高タスク完了時（恩送り）
  支払い率: 50%（平均1,500円）
  → 500人 × 1,500円 = 75万円/月

全タスク完了時（感謝の気持ち）
  支払い率: 30%（平均2,000円）
  → 300人 × 2,000円 = 60万円/月

月額収益: 約135万円
年間収益: 約1,620万円
```

### 5.2 想定コスト

#### 5.2.1 無料枠で収まる可能性が高いもの:
- **LINE公式アカウント**: フリープラン（月200通まで無料）
- **Cloud Storage（GCS）**: 数GB程度なら無料枠内
- **Cloud Functions**: 無料枠大（月200万リクエスト）
- **Pinecone**: 無料枠（1インデックス、制限あり）

#### 5.2.2 課金が発生する可能性があるもの:
- **AI API（最大のコスト）**
  - Gemini 1.5 Flash: 無料枠大（優先検討）
  - GPT-4o-mini: 安価（$0.002/1K tokens以下）
  - Claude: 中程度
- **LINE（200通超過時）**: ライトプラン 月5,000円〜
- **Cloud SQL**: 小規模インスタンス 月3,000円〜

#### 5.2.3 コスト見積もり
```
【スモールスタート（〜100人/月）】
- AI API: 5,000円
- Cloud SQL: 3,000円
- LINE: 0円（無料枠内）
- その他: 2,000円
合計: 約1万円/月

【成長期（〜1,000人/月）】
- AI API: 3万円
- Cloud SQL: 5,000円
- LINE: 5,000円
- その他: 1万円
合計: 約5万円/月

【拡大期（1,000人〜/月）】
- AI API: 10万円
- Cloud SQL: 1万円
- LINE: 1万円
- その他: 2万円
合計: 約14万円/月
```

### 5.3 持続可能性

#### 5.3.1 収支シミュレーション
```
【1,000人利用時】
収益: 60〜135万円/月
コスト: 5万円/月
利益: 55〜130万円/月 ✅ 黒字

【10,000人利用時】
収益: 600〜1,350万円/月
コスト: 14万円/月
利益: 586〜1,336万円/月 ✅ 大幅黒字
```

#### 5.3.2 リスクヘッジ
- **最悪シナリオ（各支払い率5%）でも**:
  - 優先度高タスク完了時: 1,000人 × 5% × 1,000円 = 5万円/月
  - 全タスク完了時: 1,000人 × 5% × 1,000円 = 5万円/月
  - 合計: 10万円/月
  - コスト5万円 < 収益10万円 = **黒字維持**
  - 赤字にならない設計

#### 5.3.3 運営方針
- **透明性の確保**: 運営コストと寄付総額を定期的に公開
- **コスト最適化**: 無料枠の最大活用、API選定の継続見直し
- **スケーリング計画**: ユーザー数に応じた段階的なインフラ拡張
- **善意の可視化**: 「○○人が助けられました」カウンター表示

#### 5.3.4 成功事例
類似の寄付ベースモデルで成功している事例:
- **Wikipedia**: 寄付のみで年間1.5億ドル
- **Signal**: 寄付のみで5,000万ドル
- **Archive.org**: 寄付で長期運営

→ **助けられた人は支払う傾向が高い**ことが実証されている

---

## 6. 制約事項

### 6.1 法的制約
- 法律相談・専門的なアドバイスは提供しない
- あくまで情報提供とタスク管理に特化
- 必要に応じて専門家（弁護士、行政書士等）への相談を促す

### 6.2 技術的制約
- LINE公式アカウントの機能制約に従う
- API利用料金・利用制限に注意
- 自治体情報の網羅性に限界がある場合がある

### 6.3 運用制約
- 個人開発のため、初期はサポート体制が限定的
- ユーザー数増加に伴うスケーリング対応が必要

---

## 7. 将来展開

### 7.1 生前からのサポート拡充（年単位でのライフサイクルカバー）
- **遺言作成支援**
  - 法的に有効な遺言書作成のガイド
  - 公正証書遺言、自筆証書遺言のサポート
  - 専門家（行政書士、弁護士）とのマッチング
- **資産整理・終活サポート**
  - デジタル資産の整理（アカウント、データ等）
  - 金融資産の一覧化
  - エンディングノート作成支援
- **遺産分割協議の調整支援**
  - 相続人間のコミュニケーション支援
  - 遺産分割シミュレーション
  - 専門家への橋渡し

### 7.2 横展開の可能性
- **保活（保育園入園調査・申請）へのタスク管理機能の適用**
  - 同様のヒアリング → タスク生成 → 進捗管理の仕組みが活用可能
  - 自治体ごとの情報収集・提供

### 7.3 機能拡張案
- 専門家とのマッチング機能
- コミュニティ機能（経験者との情報交換）
- 音声入力対応
- 多言語対応

---

## 付録

### 改訂履歴
| バージョン | 日付 | 変更内容 | 変更者 |
|---------|------|---------|--------|
| 1.0 | 2025-10-05 | 初版作成 | - |
| 1.1 | 2025-10-05 | ビジネスモデル追加、将来展開（生前サポート）拡充 | - |
| 2.0 | 2025-11-09 | 収益モデルを「Pay It Forward（恩送り）」に全面刷新 | - |
| 2.1 | 2025-11-09 | 支払いタイミングを最適化（1年後→全タスク完了時に変更） | - |
| 2.2 | 2025-11-09 | 恩送り機能を拡充（コメント機能、統計可視化、条件分岐メッセージ追加） | - |

---
作成日: 2025-10-05
最終更新: 2025-11-09
