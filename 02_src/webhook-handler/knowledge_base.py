"""
行政手続きナレッジベース
主要な死後手続きに関する情報を構造化して保持
"""

# 手続き情報のナレッジベース
KNOWLEDGE_BASE = {
    "死亡届": {
        "keywords": ["死亡届", "しぼうとどけ", "届出", "届け出"],
        "content": """
【死亡届の提出】
- 期限: 死亡の事実を知った日から7日以内
- 提出先: 死亡地・本籍地・届出人の住所地のいずれかの市区町村役場
- 必要書類:
  - 死亡届（医師の死亡診断書または死体検案書が必要）
  - 届出人の印鑑
  - 本人確認書類
- 届出人: 同居の親族、その他の同居者、家主、地主、後見人など
- 参考URL: https://www.mhlw.go.jp/
"""
    },
    "火葬許可": {
        "keywords": ["火葬", "かそう", "火葬許可", "埋葬許可"],
        "content": """
【火葬許可証の取得】
- 期限: 死亡届と同時に申請
- 提出先: 死亡届を提出する市区町村役場
- 必要書類: 死亡届を提出すると同時に申請可能
- 注意点:
  - 火葬許可証がないと火葬できません
  - 埋葬許可証も同時に発行されます
  - 火葬場に提出が必要
"""
    },
    "年金": {
        "keywords": ["年金", "ねんきん", "年金停止", "遺族年金"],
        "content": """
【年金受給停止の手続き】
- 期限: 死亡後14日以内（国民年金）、10日以内（厚生年金）
- 提出先:
  - 国民年金: 市区町村役場または年金事務所
  - 厚生年金: 年金事務所
- 必要書類:
  - 年金受給権者死亡届
  - 年金証書
  - 死亡診断書のコピーまたは死亡届の記載事項証明書
  - 届出人の本人確認書類
- 参考: 日本年金機構 https://www.nenkin.go.jp/

【遺族年金の請求】
- 対象: 配偶者、子、父母、孫、祖父母
- 期限: 死亡日から5年以内
- 提出先: 年金事務所
"""
    },
    "相続税": {
        "keywords": ["相続税", "そうぞくぜい", "税金", "申告"],
        "content": """
【相続税の申告】
- 期限: 相続開始を知った日の翌日から10ヶ月以内
- 提出先: 被相続人の住所地を管轄する税務署
- 基礎控除: 3,000万円 + 600万円 × 法定相続人の数
- 必要書類:
  - 相続税の申告書
  - 被相続人の戸籍謄本
  - 相続人全員の戸籍謄本
  - 遺産分割協議書（ある場合）
  - 財産評価明細書
- 参考: 国税庁 https://www.nta.go.jp/

【準確定申告】
- 期限: 相続開始を知った日の翌日から4ヶ月以内
- 対象: 死亡した年の1月1日から死亡日までの所得
"""
    },
    "健康保険": {
        "keywords": ["健康保険", "けんこうほけん", "保険証", "返却"],
        "content": """
【健康保険証の返却】
- 期限: 死亡後14日以内
- 提出先:
  - 国民健康保険: 市区町村役場
  - 社会保険: 勤務先または健康保険組合
- 必要書類:
  - 被保険者証（保険証）
  - 死亡を証明する書類
- 注意: 未使用の高額療養費や葬祭費の請求も同時に確認
"""
    },
    "世帯主変更": {
        "keywords": ["世帯主", "せたいぬし", "変更"],
        "content": """
【世帯主変更届】
- 期限: 死亡後14日以内
- 提出先: 市区町村役場
- 対象:
  - 世帯主が死亡し、残された世帯員が2人以上の場合
  - 15歳以上の世帯員が1人のみの場合は届出不要
- 必要書類:
  - 世帯主変更届
  - 届出人の本人確認書類
  - 国民健康保険証（加入者のみ）
"""
    },
}


def search_knowledge(query: str) -> str:
    """
    クエリに関連する知識を検索

    Args:
        query: ユーザーの質問

    Returns:
        関連する知識のテキスト
    """
    query_lower = query.lower()
    relevant_knowledge = []

    for topic, data in KNOWLEDGE_BASE.items():
        # キーワードマッチング
        if any(keyword in query_lower for keyword in data["keywords"]):
            relevant_knowledge.append(f"【{topic}】\n{data['content']}")

    if relevant_knowledge:
        return "\n\n".join(relevant_knowledge)
    else:
        return ""


def get_all_knowledge() -> str:
    """
    全ての知識ベースを取得（初回質問時など）

    Returns:
        全知識のテキスト
    """
    all_content = []
    for topic, data in KNOWLEDGE_BASE.items():
        all_content.append(f"【{topic}】\n{data['content']}")

    return "\n\n".join(all_content)
